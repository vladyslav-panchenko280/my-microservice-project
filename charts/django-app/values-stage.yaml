# Staging environment values
replicaCount: 2

image:
  repository: 625041985844.dkr.ecr.us-east-1.amazonaws.com/es-ecr-stage
  pullPolicy: Always
  tag: "django-stage"

service:
  type: LoadBalancer
  port: 8000

ingress:
  enabled: false

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70

configMap:
  data:
    DJANGO_SETTINGS_MODULE: django_app.settings
    DEBUG: "False"
    ENVIRONMENT: stage
    ALLOWED_HOSTS: "*"  # LoadBalancer DNS name will be dynamic

env:
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: django-db-secret
        key: database-url

postgresql:
  enabled: false

nginx:
  enabled: true
  image:
    repository: nginx
    tag: "1.25-alpine"
  config: |
    server {
      listen 80;
      server_name _;

      location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      }

      location /static/ {
        alias /app/staticfiles/;
      }
    }

