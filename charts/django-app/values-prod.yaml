# Production environment values
replicaCount: 3

image:
  repository: 625041985844.dkr.ecr.us-east-1.amazonaws.com/es-ecr-prod
  pullPolicy: IfNotPresent
  tag: "prod-latest"

service:
  type: LoadBalancer
  port: 8000

ingress:
  enabled: true
  className: "alb"
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/ssl-redirect: "443"
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:us-east-1:ACCOUNT_ID:certificate/CERT_ID"
  hosts:
    - host: django-app.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: django-app-prod-tls
      hosts:
        - django-app.example.com

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 1000m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

configMap:
  data:
    DJANGO_SETTINGS_MODULE: django_app.settings
    DEBUG: "False"
    ENVIRONMENT: prod
    ALLOWED_HOSTS: "django-app.example.com"

env:
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: django-db-secret
        key: database-url

# PostgreSQL configuration (use RDS in production)
postgresql:
  enabled: false

# Nginx sidecar configuration
nginx:
  enabled: true
  image:
    repository: nginx
    tag: "1.25-alpine"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  config: |
    server {
      listen 80;
      server_name django-app.example.com;
      
      location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
      
      location /static/ {
        alias /app/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
      }
      
      location /media/ {
        alias /app/media/;
        expires 30d;
        add_header Cache-Control "public, immutable";
      }
    }

# Pod disruption budget for high availability
podDisruptionBudget:
  enabled: true
  minAvailable: 2

