kube-prometheus-stack:
  global:
    rbac:
      create: true
      createAggregateClusterRoles: false

  prometheus:
    enabled: true

    service:
      type: LoadBalancer
      annotations:
        service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"

    prometheusSpec:
      retention: 15d
      retentionSize: "50GB"

      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: gp3
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 50Gi

      resources:
        requests:
          cpu: 500m
          memory: 2Gi
        limits:
          cpu: 2000m
          memory: 4Gi

      serviceMonitorSelector: {}
      serviceMonitorNamespaceSelector: {}
      podMonitorSelector: {}
      podMonitorNamespaceSelector: {}
      additionalScrapeConfigs: []
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 2000
      podDisruptionBudget:
        enabled: false
        minAvailable: 1

  grafana:
    enabled: true

    adminPassword: "admin"

    service:
      type: LoadBalancer
      annotations:
        service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"

    persistence:
      enabled: true
      storageClassName: gp3
      size: 10Gi

    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

    defaultDashboardsEnabled: true
    defaultDashboardsTimezone: UTC

    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
          - name: Prometheus
            type: prometheus
            url: http://prometheus-operated:9090
            access: proxy
            isDefault: true

    plugins:
      - grafana-piechart-panel
      - grafana-clock-panel

  alertmanager:
    enabled: true

    service:
      type: ClusterIP

    alertmanagerSpec:
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: gp3
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 5Gi

      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 200m
          memory: 256Mi

      retention: 120h

    config:
      global:
        resolve_timeout: 5m

      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 12h
        receiver: 'null'
        routes:
          - match:
              alertname: Watchdog
            receiver: 'null'

      receivers:
        - name: 'null'

  prometheus-node-exporter:
    enabled: true

    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

    prometheus:
      monitor:
        enabled: true

  kube-state-metrics:
    enabled: true

    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

    prometheus:
      monitor:
        enabled: true

  prometheusOperator:
    enabled: true

    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

    tls:
      enabled: true

    admissionWebhooks:
      enabled: true
      patch:
        enabled: true

  coreDns:
    enabled: true

  kubelet:
    enabled: true
    namespace: kube-system

  kubeApiServer:
    enabled: true

  kubeControllerManager:
    enabled: true

  kubeScheduler:
    enabled: true

  kubeEtcd:
    enabled: false

  kubeProxy:
    enabled: true

environment: base

namespace: monitoring
